local NET = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Net")
local children = NET:GetChildren()
local jobId = game.JobId
local jobIdNoHyph = jobId:gsub("-", "")
local target = "PlotService/Sell"
local prefix = "RE/"
local targetLen = #target

local function xorStr(enc, key)
    if #key == 0 then return enc end
    local r = {}
    for i = 1, #enc do
        r[i] = string.char(bit32.bxor(string.byte(enc, i), string.byte(key, ((i - 1) % #key) + 1)))
    end
    return table.concat(r)
end

local function subStr(enc, key)
    if #key == 0 then return enc end
    local r = {}
    for i = 1, #enc do
        r[i] = string.char((string.byte(enc, i) - string.byte(key, ((i - 1) % #key) + 1)) % 256)
    end
    return table.concat(r)
end

local function addStr(enc, key)
    if #key == 0 then return enc end
    local r = {}
    for i = 1, #enc do
        r[i] = string.char((string.byte(enc, i) + string.byte(key, ((i - 1) % #key) + 1)) % 256)
    end
    return table.concat(r)
end

local keys = {jobId, jobIdNoHyph, jobId:upper(), jobIdNoHyph:lower(), string.reverse(jobId), string.reverse(jobIdNoHyph)}
local ciphers = {xorStr, subStr, addStr}

local found = nil
local honeypot1 = prefix .. target
local honeypot2 = prefix .. "SellService/Sell"

-- First, try to elegantly decrypt it
for _, child in ipairs(children) do
    local body = child.Name:match("^" .. prefix .. "(.+)$")
    if body and #body == targetLen then
        for _, key in ipairs(keys) do
            for _, fn in ipairs(ciphers) do
                local dec = fn(body, key)
                if dec == target and child.Name ~= honeypot1 and child.Name ~= honeypot2 then
                    found = child
                    break
                end
            end
            if found then break end
        end
        if found then break end
    end
end

if found then
    return {found}
end

-- If decryption fails (e.g. MBA cipher), fallback to exact-length match.
-- Find all RemoteEvents where body length == 16, and NOT a honeypot.
local candidates = {}
for _, child in ipairs(children) do
    if child:IsA("RemoteEvent") then
        local body = child.Name:match("^" .. prefix .. "(.+)$")
        if body and #body == targetLen and child.Name ~= honeypot1 and child.Name ~= honeypot2 then
            table.insert(candidates, child)
        end
    end
end

-- Returning all valid candidates lets the bot's pcall() loop safely fire them until one works
return candidates
